{% extends "intake/base.html" %} {% block content %}

<style>
    .nav-pills > li.active > a, .nav-pills > li.active > a:focus {
        color: white;
        background-color: #fcd900;
    }

    .nav-pills > li.active > a:hover {
        background-color: #efcb00;
        color:black;
    }
</style>

<div class="row">
    <div class="col-md-6 col-sm-12">
        <span class="display-4">{{ sensor.name }}</span>
        <span class="h4">{{ sensor.url_string }}</span>
    </div>
    <div class="col-md-6 col-sm-12">
        <div class="card card-inverse" style="background-color: #333; border-color: #333">
            <div class="card-block">
                <div class="card-body">
                    <strong> <span class="text-warning">Earliest measurement: </span> </strong> {{ sensor.bounds.earliest }} <br>
                    <strong> <span class="text-warning">Latest measurement: </span> </strong> {{ sensor.bounds.latest }}
                </div>
            </div>
        </div>
    </div>
</div>
<hr>
<div class="row">
    <div class="col-sm-12">
        <ul class="nav nav-pills" role="tablist">
            <li class="nav-item">
                <a class="nav-link active" data-toggle="pill" href="#onehour" role="tab">1 Hour</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-toggle="pill" href="#oneday" role="tab">1 Day</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-toggle="pill" href="#oneweek" role="tab">1 Week</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-toggle="pill" href="#onemonth" role="tab">1 Month</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-toggle="pill" href="#threemonth" role="tab">3 Months</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-toggle="pill" href="#sixmonth" role="tab">6 Months</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-toggle="pill" href="#oneyear" role="tab">1 Year</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-toggle="pill" href="#alltime" role="tab">All Time</a>
            </li>
        </ul>
        <div class="tab-content">
            <div class="tab-pane active" id="onehour" role="tabpanel">
                <div class="row">
                    <div class="col-sm-8" id="graph">
                        <div id="last-hour" , width="100%" , height="80%"></div>
                    </div>
                    <div class="col-sm-4">
                        <div class="card text-center card-inverse" style="background-color: #333; border-color: #333">
                            <div class="card-block">
                                <div class="card-body">
                                    <h4> Watts Generated </h4>
                                    <h2 class="card-title text-warning">{{ sensor.generated_hour }}</h2>
                                </div>
                            </div>
                        </div>
                        <br>
                        <div class="card text-center card-inverse" style="background-color: #333; border-color: #333">
                            <div class="card-block">
                                <div class="card-body">
                                    <h4> Measurements </h4>
                                    <h2 class="card-title text-warning">{{ sensor.count_hour }}</h2>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="tab-pane" id="oneday" role="tabpanel">
                <div class="row">
                    <div class="col-sm-8" id="graph">
                        <div id="loading-message">
                            <div class="alert alert-warning" role="alert">
                                <strong>Crunching data...</strong> this may take a few seconds.
                            </div>
                        </div>
                        <div id="last-day", width="100%", height="80%"></div>
                    </div>
                    <div class="col-sm-4">
                        <div class="card text-center card-inverse" style="background-color: #333; border-color: #333">
                            <div class="card-block">
                                <div class="card-body">
                                    <h4> Watts Generated </h4>
                                    <h2 class="card-title text-warning">{{ sensor.generated_day }}</h2>
                                </div>
                            </div>
                        </div>
                        <br>
                        <div class="card text-center card-inverse" style="background-color: #333; border-color: #333">
                            <div class="card-block">
                                <div class="card-body">
                                    <h4> Measurements </h4>
                                    <h2 class="card-title text-warning">{{ sensor.count_day }}</h2>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="tab-pane" id="oneweek" role="tabpanel">
                <div class="row">
                    <div class="col-sm-8" id="graph">
                        <div id="loading-message">
                            <div class="alert alert-warning" role="alert">
                                <strong>Crunching data...</strong> this may take a few seconds.
                            </div>
                        </div>
                        <div id="last-week" , width="100%" , height="80%"></div>
                    </div>
                    <div class="col-sm-4">
                        <div class="card text-center card-inverse" style="background-color: #333; border-color: #333">
                            <div class="card-block">
                                <div class="card-body">
                                    <h4> Watts Generated </h4>
                                    <h2 class="card-title text-warning">{{ sensor.generated_week }}</h2>
                                </div>
                            </div>
                        </div>
                        <br>
                        <div class="card text-center card-inverse" style="background-color: #333; border-color: #333">
                            <div class="card-block">
                                <div class="card-body">
                                    <h4> Measurements </h4>
                                    <h2 class="card-title text-warning">{{ sensor.count_week }}</h2>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="tab-pane" id="onemonth" role="tabpanel">
                <div class="row">
                    <div class="col-sm-8" id="graph">
                        <div id="loading-message">
                            <div class="alert alert-warning" role="alert">
                                <strong>Crunching data...</strong> this may take a few seconds.
                            </div>
                        </div>
                        <div id="last-month" , width="100%" , height="80%"></div>
                    </div>
                    <div class="col-sm-4">
                        <div class="card text-center card-inverse" style="background-color: #333; border-color: #333">
                            <div class="card-block">
                                <div class="card-body">
                                    <h4> Watts Generated </h4>
                                    <h2 class="card-title text-warning">{{ sensor.generated_month }}</h2>
                                </div>
                            </div>
                        </div>
                        <br>
                        <div class="card text-center card-inverse" style="background-color: #333; border-color: #333">
                            <div class="card-block">
                                <div class="card-body">
                                    <h4> Measurements </h4>
                                    <h2 class="card-title text-warning">{{ sensor.count_month }}</h2>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="tab-pane" id="threemonth" role="tabpanel">
                <div class="row">
                    <div class="col-sm-8" id="graph">
                        <div id="loading-message">
                            <div class="alert alert-warning" role="alert">
                                <strong>Crunching data...</strong> this may take a few seconds.
                            </div>
                        </div>
                        <div id="last-threemonth" , width="100%" , height="80%"></div>
                    </div>
                    <div class="col-sm-4">
                        <div class="card text-center card-inverse" style="background-color: #333; border-color: #333">
                            <div class="card-block">
                                <div class="card-body">
                                    <h4> Watts Generated </h4>
                                    <h2 class="card-title text-warning">{{ sensor.generated_3month }}</h2>
                                </div>
                            </div>
                        </div>
                        <br>
                        <div class="card text-center card-inverse" style="background-color: #333; border-color: #333">
                            <div class="card-block">
                                <div class="card-body">
                                    <h4> Measurements </h4>
                                    <h2 class="card-title text-warning">{{ sensor.count_3month }}</h2>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="tab-pane" id="sixmonth" role="tabpanel">
                <div class="row">
                    <div class="col-sm-8" id="graph">
                        <div id="loading-message">
                            <div class="alert alert-warning" role="alert">
                                <strong>Crunching data...</strong> this may take a few seconds.
                            </div>
                        </div>
                        <div id="last-sixmonth" , width="100%" , height="80%"></div>
                    </div>
                    <div class="col-sm-4">
                        <div class="card text-center card-inverse" style="background-color: #333; border-color: #333">
                            <div class="card-block">
                                <div class="card-body">
                                    <h4> Watts Generated </h4>
                                    <h2 class="card-title text-warning">{{ sensor.generated_6month }}</h2>
                                </div>
                            </div>
                        </div>
                        <br>
                        <div class="card text-center card-inverse" style="background-color: #333; border-color: #333">
                            <div class="card-block">
                                <div class="card-body">
                                    <h4> Measurements </h4>
                                    <h2 class="card-title text-warning">{{ sensor.count_6month }}</h2>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="tab-pane" id="oneyear" role="tabpanel">
                <div class="row">
                    <div class="col-sm-8" id="graph">
                        <div id="loading-message">
                            <div class="alert alert-warning" role="alert">
                                <strong>Crunching data...</strong> this may take a few seconds.
                            </div>
                        </div>
                        <div id="last-year" , width="100%" , height="80%"></div>
                    </div>
                    <div class="col-sm-4">
                        <div class="card text-center card-inverse" style="background-color: #333; border-color: #333">
                            <div class="card-block">
                                <div class="card-body">
                                    <h4> Watts Generated </h4>
                                    <h2 class="card-title text-warning">{{ sensor.generated_year }}</h2>
                                </div>
                            </div>
                        </div>
                        <br>
                        <div class="card text-center card-inverse" style="background-color: #333; border-color: #333">
                            <div class="card-block">
                                <div class="card-body">
                                    <h4> Measurements </h4>
                                    <h2 class="card-title text-warning">{{ sensor.count_year }}</h2>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="tab-pane" id="alltime" role="tabpanel">
                <div class="row">
                    <div class="col-sm-8" id="graph">
                        <div id="loading-message">
                            <div class="alert alert-warning" role="alert">
                                <strong>Crunching data...</strong> this may take a few seconds.
                            </div>
                        </div>
                        <div id="all-time" , width="100%" , height="80%"></div>
                    </div>
                    <div class="col-sm-4">
                        <div class="card text-center card-inverse" style="background-color: #333; border-color: #333">
                            <div class="card-block">
                                <div class="card-body">
                                    <h4> Watts Generated </h4>
                                    <h2 class="card-title text-warning">{{ sensor.generated_all_time }}</h2>
                                </div>
                            </div>
                        </div>
                        <br>
                        <div class="card text-center card-inverse" style="background-color: #333; border-color: #333">
                            <div class="card-block">
                                <div class="card-body">
                                    <h4> Measurements </h4>
                                    <h2 class="card-title text-warning">{{ sensor.count_all_time }}</h2>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>

<script>

    let graphs = {
        'onehour': {
        element: 'last-hour',
        data: {{ sensor.last_hour | safe }},
        xkey: 'timestamp',
        ykeys: ['generated'],
        labels: ["Generated"],
        goals: [0, ],
        pointSize: 0,
        lineColors: ['#f0ad4e'],
        built: true
    },

    'oneday': {
        element: 'last-day',
        data: {{ sensor.last_day | safe }},
        xkey: 'timestamp',
        ykeys: ['generated'],
        labels: ["Generated"],
        goals: [0, ],
        pointSize: 0,
        lineColors: ['#f0ad4e'],
        built: false
    },

    'oneweek': {
        element: 'last-week',
        data: {{ sensor.last_week | safe }},
        xkey: 'timestamp',
        ykeys: ['generated'],
        labels: ["Generated"],
        goals: [0, ],
        pointSize: 0,
        lineColors: ['#f0ad4e'],
        built: false
    },

    'onemonth': {
        element: 'last-month',
        data: {{ sensor.last_month | safe }},
        xkey: 'timestamp',
        ykeys: ['generated'],
        labels: ["Generated"],
        goals: [0, ],
        pointSize: 0,
        lineColors: ['#f0ad4e'],
        built: false
    },

    'threemonth': {
        element: 'last-threemonth',
        data: {{ sensor.last_3month | safe }},
        xkey: 'timestamp',
        ykeys: ['generated'],
        labels: ["Generated"],
        goals: [0, ],
        pointSize: 0,
        lineColors: ['#f0ad4e'],
        built: false
    },

    'sixmonth': {
        element: 'last-sixmonth',
        data: {{ sensor.last_6month | safe }},
        xkey: 'timestamp',
        ykeys: ['generated'],
        labels: ["Generated"],
        goals: [0, ],
        pointSize: 0,
        lineColors: ['#f0ad4e'],
        built: false
    },
    
    'oneyear': {
        element: 'last-year',
        data: {{ sensor.last_year | safe }},
        xkey: 'timestamp',
        ykeys: ['generated'],
        labels: ["Generated"],
        goals: [0, ],
        pointSize: 0,
        lineColors: ['#f0ad4e'],
        built: false
    },
    
    'alltime': {
        element: 'all-time',
        data: {{ sensor.all_time | safe }},
        xkey: 'timestamp',
        ykeys: ['generated'],
        labels: ["Generated"],
        goals: [0, ],
        pointSize: 0,
        lineColors: ['#f0ad4e'],
        built: false
    },
}

var graph = new Morris.Line(graphs['onehour'])
graphs['onehour'].built = true;


$('a[data-toggle="pill"]').on('shown.bs.tab', function (e) {
  let id = $(e.target).attr('href').substr(1);
  let oldId = $(e.relatedTarget).attr('href').substr(1);
  let toClear = $(e.relatedTarget).attr('href');
  let toFill = $(e.target).attr('href')

  if(!graphs[id].built) {
    graph = new Morris.Line(graphs[id]);
    $(toFill).find('#loading-message').remove();
    graphs[id].built = true;
  }

})
</script>

{% endblock %}